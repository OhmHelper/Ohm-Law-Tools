<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lab Calculators ‚Äì Electronics & Physics Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Free online electronics & physics calculators with dark/light themes, study tools, and note-card guides." />

  <style>
    /* ========= THEME VARIABLES ========= */
    :root {
      --bg: #050608;
      --fg: #f5f5f5;
      --card-bg: #10121a;
      --accent: #7f9dff;
      --border: #2c2c2c;
      --muted: #9a9a9a;
      --shadow: 0 8px 22px rgba(0,0,0,0.4);
    }

    [data-theme="light"] {
      --bg: #f9f9fb;
      --fg: #111;
      --card-bg: #ffffff;
      --accent: #4f6bff;
      --border: #cccccc;
      --muted: #555;
      --shadow: 0 4px 16px rgba(0,0,0,0.12);
    }

    [data-theme="oled"] {
      --bg: #000000;
      --fg: #f7f7f7;
      --card-bg: #050508;
      --accent: #7f9dff;
      --border: #202020;
      --muted: #9a9a9a;
      --shadow: 0 10px 30px rgba(0,0,0,0.7);
    }

    [data-theme="midnight"] {
      --bg: #020618;
      --fg: #e5ecff;
      --card-bg: #050b2a;
      --accent: #5b8dff;
      --border: #202648;
      --muted: #a2b0ff;
      --shadow: 0 10px 30px rgba(2, 6, 24, 0.8);
    }

    [data-theme="paper"] {
      --bg: #f5f1e8;
      --fg: #26211a;
      --card-bg: #fcfaf5;
      --accent: #c06030;
      --border: #d8c8aa;
      --muted: #7f705f;
      --shadow: 0 4px 16px rgba(120,90,60,0.2);
    }

    [data-theme="hacker"] {
      --bg: #020403;
      --fg: #c0ffb0;
      --card-bg: #020805;
      --accent: #00ff7f;
      --border: #064b2e;
      --muted: #6bbf90;
      --shadow: 0 8px 22px rgba(0,0,0,0.8);
    }

    html {
      scroll-behavior: smooth;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    /* ========= HEADER ========= */
    header {
      padding: 1.4rem 1.2rem 0.8rem;
      max-width: 1100px;
      margin: 0 auto;
    }

    h1 {
      margin: 0 0 0.25rem;
      font-size: clamp(1.8rem, 2.8vw, 2.5rem);
    }

    header p {
      margin: 0;
      opacity: 0.85;
      font-size: 0.95rem;
      color: var(--muted);
    }

    /* ========= NAV ========= */
    nav {
      position: sticky;
      top: 0;
      z-index: 999;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1.2rem;
      background: rgba(0,0,0,0.18);
      background-color: var(--bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      max-width: 1100px;
      margin: 0 auto;
    }

    .nav-links {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: center;
      flex: 1;
    }

    .nav-link,
    #themeToggle,
    #searchBtn {
      padding: 0.35rem 0.75rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      text-decoration: none;
      color: var(--fg);
      font-size: 0.8rem;
      cursor: pointer;
      background: transparent;
      transition: background 0.2s, border-color 0.2s, transform 0.1s;
      white-space: nowrap;
    }

    .nav-link:hover,
    #themeToggle:hover,
    #searchBtn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    #searchBox {
      padding: 0.35rem 0.6rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--fg);
      font-size: 0.8rem;
      min-width: 140px;
    }

    #themeSelect {
      padding: 0.35rem 0.6rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--fg);
      font-size: 0.8rem;
    }

    #menuToggle {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--fg);
      font-size: 1rem;
      padding: 0.25rem 0.55rem;
      cursor: pointer;
      display: none;
    }

    #menuToggle:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    /* Mobile nav */
    @media (max-width: 700px) {
      nav {
        position: sticky;
        top: 0;
      }

      #menuToggle {
        display: inline-flex;
      }

      .nav-links {
        display: none;
      }

      nav.nav-open .nav-links {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        position: fixed;
        top: 3rem;
        left: 0;
        width: 70%;
        max-width: 260px;
        height: calc(100% - 3rem);
        background: var(--bg);
        padding: 0.9rem;
        box-shadow: 0 12px 30px rgba(0,0,0,0.7);
        overflow-y: auto;
      }
    }

    /* ========= LAYOUT / CARDS ========= */
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1rem 1.2rem 2.5rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.2rem;
    }

    .section-header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-top: 1.6rem;
    }

    .section-title {
      margin: 0;
      font-size: 1.1rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .chip {
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--fg);
      font-size: 0.75rem;
      cursor: pointer;
    }

    .chip:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .card {
      background: var(--card-bg);
      padding: 1rem;
      border-radius: 1rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      opacity: 0;
      transform: translateY(8px);
      animation: fadeUp 0.5s ease forwards;
    }

    .card h2 {
      margin: 0 0 0.3rem;
      font-size: 1.05rem;
    }

    .card small {
      opacity: 0.75;
      display: block;
      margin-bottom: 0.6rem;
      font-size: 0.8rem;
    }

    label {
      font-size: 0.8rem;
      margin-top: 0.5rem;
      display: block;
    }

    input,
    select {
      width: 100%;
      padding: 0.35rem;
      margin-top: 0.2rem;
      border-radius: 6px;
      background: var(--bg);
      color: var(--fg);
      border: 1px solid var(--border);
      font-size: 0.85rem;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent);
    }

    button {
      margin-top: 0.6rem;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: white;
      cursor: pointer;
      font-size: 0.85rem;
      transition: 0.2s;
    }

    button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .result {
      margin-top: 0.6rem;
      padding: 0.5rem;
      border-radius: 0.5rem;
      background: rgba(255,255,255,0.05);
      font-size: 0.9rem;
      overflow-x: auto;
    }

    .hint {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 0.1rem;
    }

    .hidden-card {
      display: none !important;
    }

    .highlight {
      box-shadow: 0 0 0 2px var(--accent), var(--shadow);
    }

    /* NOTE CARD SECTION */
    .notes-section {
      grid-column: 1 / -1;
      padding: 1rem;
      background: var(--card-bg);
      border-radius: 1rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }

    .notes-section h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: var(--accent);
    }

    .notes-section h3 {
      margin-bottom: 0.25rem;
      margin-top: 0.9rem;
      font-size: 1rem;
    }

    .notes-list {
      padding-left: 1.1rem;
      margin: 0.2rem 0 0.4rem;
      font-size: 0.9rem;
    }

    .notes-list li {
      margin-bottom: 0.25rem;
    }

    .notes-download {
      margin-top: 0.8rem;
      font-size: 0.9rem;
    }

    .notes-download a {
      color: var(--accent);
      text-decoration: none;
    }

    .notes-download a:hover {
      text-decoration: underline;
    }

    /* FOOTER */
    footer {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1.2rem 2.5rem;
      font-size: 0.8rem;
      color: var(--muted);
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }

    /* BACK TO TOP BUTTON */
    #backToTop {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      padding: 0.5rem 0.8rem;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: white;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s, transform 0.2s;
      z-index: 1000;
    }

    #backToTop.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    /* ANIMATIONS */
    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>

<body>
<header>
  <h1>Lab Calculators</h1>
  <p>Modern electronics & physics calculators with themes, study tools, and note-card guides.</p>
</header>

<nav id="topNav">
  <button id="menuToggle">‚ò∞</button>
  <div class="nav-links" id="navLinks">
    <button class="nav-link" onclick="scrollToId('electronics-header')">Electronics</button>
    <button class="nav-link" onclick="scrollToId('physics-header')">Physics</button>
    <button class="nav-link" onclick="scrollToId('notes')">Note Cards</button>
    <a class="nav-link" href="study.html">Study Tools</a>
    <a class="nav-link" href="about.html">About</a>

    <input id="searchBox" type="text" placeholder="Search calculators..." />
    <button id="searchBtn">Search</button>

    <select id="themeSelect" aria-label="Theme">
      <option value="system">System</option>
      <option value="dark">Dark</option>
      <option value="light">Light</option>
      <option value="oled">OLED</option>
      <option value="midnight">Midnight</option>
      <option value="paper">Paper</option>
      <option value="hacker">Hacker</option>
    </select>
  </div>
</nav>

<main>
  <!-- ========= ELECTRONICS ========= -->
  <div class="section-header" id="electronics-header">
    <h2 class="section-title">Electronics Calculators</h2>
    <button class="chip" id="toggleElectronics">Collapse</button>
  </div>

  <!-- Ohm's Law -->
  <section class="card electronics-card" id="ohm">
    <h2>Ohm's Law &amp; Power</h2>
    <small>Enter any two values and I'll compute the rest.</small>

    <label>Voltage V (volts)
      <input type="number" step="any" id="ohmV" placeholder="e.g. 12" />
    </label>
    <label>Current I (amps)
      <input type="number" step="any" id="ohmI" placeholder="e.g. 0.5" />
    </label>
    <label>Resistance R (ohms)
      <input type="number" step="any" id="ohmR" placeholder="e.g. 24" />
    </label>

    <button onclick="calcOhm()">Calculate</button>
    <div class="result" id="ohmResult"></div>
  </section>

  <!-- Series / Parallel resistors -->
  <section class="card electronics-card">
    <h2>Equivalent Resistance</h2>
    <small>Series or parallel combination of up to 6 resistors.</small>

    <label>Mode
      <select id="reqMode">
        <option value="series">Series</option>
        <option value="parallel">Parallel</option>
      </select>
    </label>

    <label>Resistors (ohms, comma-separated)
      <input type="text" id="reqList" placeholder="e.g. 10, 22, 47" />
    </label>
    <div class="hint">Leave empty values out; only numbers and commas.</div>

    <button onclick="calcReq()">Calculate</button>
    <div class="result" id="reqResult"></div>
  </section>

  <!-- Voltage divider -->
  <section class="card electronics-card">
    <h2>Voltage Divider</h2>
    <small>Two-resistor divider: Vout = Vin √ó R2 / (R1 + R2).</small>

    <label>Input Voltage Vin (V)
      <input type="number" step="any" id="vdVin" placeholder="e.g. 12" />
    </label>
    <label>R1 (ohms)
      <input type="number" step="any" id="vdR1" placeholder="e.g. 4700" />
    </label>
    <label>R2 (ohms)
      <input type="number" step="any" id="vdR2" placeholder="e.g. 2200" />
    </label>

    <button onclick="calcVoltageDivider()">Calculate</button>
    <div class="result" id="vdResult"></div>
  </section>

  <!-- LED resistor -->
  <section class="card electronics-card">
    <h2>LED Series Resistor</h2>
    <small>Compute resistor to set LED current.</small>

    <label>Supply Voltage Vs (V)
      <input type="number" step="any" id="ledVs" placeholder="e.g. 5" />
    </label>
    <label>LED Forward Voltage Vf (V)
      <input type="number" step="any" id="ledVf" placeholder="e.g. 2" />
    </label>
    <label>LED Current If (mA)
      <input type="number" step="any" id="ledIf" placeholder="e.g. 20" />
    </label>

    <button onclick="calcLed()">Calculate</button>
    <div class="result" id="ledResult"></div>
  </section>

  <!-- RC time constant -->
  <section class="card electronics-card" id="rc">
    <h2>RC Time Constant &amp; Cutoff</h2>
    <small>First-order RC: œÑ = R¬∑C, fc ‚âà 1 / (2œÄRC).</small>

    <label>Resistance R (ohms)
      <input type="number" step="any" id="rcR" placeholder="e.g. 10000" />
    </label>
    <label>Capacitance C (farads)
      <input type="number" step="any" id="rcC" placeholder="e.g. 0.000001 (1 ¬µF)" />
    </label>

    <button onclick="calcRC()">Calculate</button>
    <div class="result" id="rcResult"></div>
  </section>

  <!-- RL time constant -->
  <section class="card electronics-card">
    <h2>RL Time Constant &amp; Cutoff</h2>
    <small>First-order RL: œÑ = L / R.</small>

    <label>Resistance R (ohms)
      <input type="number" step="any" id="rlR" placeholder="e.g. 10" />
    </label>
    <label>Inductance L (henries)
      <input type="number" step="any" id="rlL" placeholder="e.g. 0.01" />
    </label>

    <button onclick="calcRL()">Calculate</button>
    <div class="result" id="rlResult"></div>
  </section>

  <!-- LC resonance -->
  <section class="card electronics-card" id="resonance">
    <h2>LC Resonant Frequency</h2>
    <small>f‚ÇÄ = 1 / (2œÄ‚àö(LC)).</small>

    <label>Inductance L (henries)
      <input type="number" step="any" id="lcL" placeholder="e.g. 0.001" />
    </label>
    <label>Capacitance C (farads)
      <input type="number" step="any" id="lcC" placeholder="e.g. 0.000000001 (1 nF)" />
    </label>

    <button onclick="calcLC()">Calculate</button>
    <div class="result" id="lcResult"></div>
  </section>

  <!-- Energy storage -->
  <section class="card electronics-card">
    <h2>Energy in C / L</h2>
    <small>Capacitor: ¬ΩCV¬≤. Inductor: ¬ΩLI¬≤.</small>

    <label>Capacitance C (F)
      <input type="number" step="any" id="eC" placeholder="e.g. 0.00047" />
    </label>
    <label>Capacitor Voltage V (V)
      <input type="number" step="any" id="eV" placeholder="e.g. 16" />
    </label>

    <label>Inductance L (H)
      <input type="number" step="any" id="eL" placeholder="e.g. 0.01" />
    </label>
    <label>Inductor Current I (A)
      <input type="number" step="any" id="eI" placeholder="e.g. 2" />
    </label>

    <button onclick="calcEnergy()">Calculate</button>
    <div class="result" id="eResult"></div>
  </section>

  <!-- dB gain -->
  <section class="card electronics-card">
    <h2>dB Gain</h2>
    <small>Voltage or power gain in decibels.</small>

    <label>Mode
      <select id="dbMode">
        <option value="voltage">Voltage gain (20¬∑log‚ÇÅ‚ÇÄ(Vout/Vin))</option>
        <option value="power">Power gain (10¬∑log‚ÇÅ‚ÇÄ(Pout/Pin))</option>
      </select>
    </label>

    <label>Input (Vin or Pin)
      <input type="number" step="any" id="dbIn" placeholder="e.g. 1" />
    </label>
    <label>Output (Vout or Pout)
      <input type="number" step="any" id="dbOut" placeholder="e.g. 10" />
    </label>

    <button onclick="calcDB()">Calculate</button>
    <div class="result" id="dbResult"></div>
  </section>

  <!-- ========= PHYSICS ========= -->
  <div class="section-header" id="physics-header">
    <h2 class="section-title">Physics Calculators</h2>
    <button class="chip" id="togglePhysics">Collapse</button>
  </div>

  <!-- Kinematics -->
  <section class="card physics-card" id="kinematics">
    <h2>1D Kinematics (constant a)</h2>
    <small>Uses v¬≤ = v‚ÇÄ¬≤ + 2aŒîx and v = v‚ÇÄ + a¬∑t.</small>

    <label>Initial velocity v‚ÇÄ (m/s)
      <input type="number" step="any" id="kmV0" placeholder="e.g. 0" />
    </label>
    <label>Acceleration a (m/s¬≤)
      <input type="number" step="any" id="kmA" placeholder="e.g. 9.8" />
    </label>
    <label>Time t (s)
      <input type="number" step="any" id="kmT" placeholder="optional" />
    </label>
    <label>Displacement Œîx (m)
      <input type="number" step="any" id="kmDx" placeholder="optional" />
    </label>

    <button onclick="calcKinematics()">Solve</button>
    <div class="result" id="kmResult"></div>
  </section>

  <!-- Projectile -->
  <section class="card physics-card" id="projectile">
    <h2>Projectile Motion</h2>
    <small>Flat ground, ignore air resistance.</small>

    <label>Initial speed v‚ÇÄ (m/s)
      <input type="number" step="any" id="pmV0" placeholder="e.g. 20" />
    </label>
    <label>Launch angle Œ∏ (degrees)
      <input type="number" step="any" id="pmAngle" placeholder="e.g. 45" />
    </label>
    <label>Gravity g (m/s¬≤)
      <input type="number" step="any" id="pmG" placeholder="9.8" />
    </label>

    <button onclick="calcProjectile()">Calculate</button>
    <div class="result" id="pmResult"></div>
  </section>

  <!-- Newton's law -->
  <section class="card physics-card">
    <h2>Force &amp; Weight</h2>
    <small>F = m¬∑a and weight W = m¬∑g.</small>

    <label>Mass m (kg)
      <input type="number" step="any" id="nwM" placeholder="e.g. 5" />
    </label>
    <label>Acceleration a (m/s¬≤)
      <input type="number" step="any" id="nwA" placeholder="e.g. 2" />
    </label>
    <label>Gravity g (m/s¬≤) for weight
      <input type="number" step="any" id="nwG" placeholder="9.8" />
    </label>

    <button onclick="calcNewton()">Calculate</button>
    <div class="result" id="nwResult"></div>
  </section>

  <!-- Momentum / KE -->
  <section class="card physics-card">
    <h2>Momentum &amp; Kinetic Energy</h2>
    <small>p = m¬∑v, KE = ¬Ωm¬∑v¬≤.</small>

    <label>Mass m (kg)
      <input type="number" step="any" id="mkM" placeholder="e.g. 1.5" />
    </label>
    <label>Speed v (m/s)
      <input type="number" step="any" id="mkV" placeholder="e.g. 10" />
    </label>

    <button onclick="calcMomentumKE()">Calculate</button>
    <div class="result" id="mkResult"></div>
  </section>

  <!-- ========= STUDY NOTE CARD SECTION ========= -->
  <section class="notes-section" id="notes">
    <h2>What to Put on Your Physics Note Card</h2>
    <p>Perfect for midterms & finals. These are high-yield formulas and ideas.</p>

    <h3>üìò Mechanics</h3>
    <ul class="notes-list">
      <li>Kinematics: v = v‚ÇÄ + at,  Œîx = v‚ÇÄt + ¬Ωat¬≤,  v¬≤ = v‚ÇÄ¬≤ + 2aŒîx</li>
      <li>Force: F = ma</li>
      <li>Weight: W = mg</li>
      <li>Momentum: p = mv</li>
      <li>Kinetic Energy: KE = ¬Ωmv¬≤</li>
      <li>Potential Energy: PE = mgh</li>
      <li>Work: W = F¬∑d¬∑cosŒ∏</li>
      <li>Power: P = W/t = Fv</li>
    </ul>

    <h3>üîå Circuits</h3>
    <ul class="notes-list">
      <li>Ohm‚Äôs Law: V = IR</li>
      <li>Power: P = VI = I¬≤R = V¬≤/R</li>
      <li>RC: œÑ = RC, cutoff fc ‚âà 1/(2œÄRC)</li>
      <li>RL: œÑ = L/R, cutoff fc ‚âà R/(2œÄL)</li>
      <li>Resonance: f‚ÇÄ = 1/(2œÄ‚àö(LC))</li>
    </ul>

    <h3>üìê Vectors</h3>
    <ul class="notes-list">
      <li>Dot product: a¬∑b = |a||b|cosŒ∏</li>
      <li>Cross product magnitude: |a√ób| = |a||b|sinŒ∏</li>
      <li>Unit vector: √ª = u / |u|</li>
    </ul>

    <h3>üì° Waves / EM</h3>
    <ul class="notes-list">
      <li>Wave speed: v = fŒª</li>
      <li>Intensity: I = P/A</li>
      <li>Coulomb‚Äôs Law: F = kq‚ÇÅq‚ÇÇ/r¬≤</li>
      <li>Field from point charge: E = kq/r¬≤</li>
    </ul>

    <div class="notes-download">
      Downloadable PDF (once you add it to the repo):
      <br />
      <code>assets/physics-notes.pdf</code> ‚Üí 
      <a href="assets/physics-notes.pdf" download>Download Physics Note Card (PDF)</a>
    </div>
  </section>
</main>

<footer>
  <p>
    ¬© Lab Calculators ‚Äî Educational use only.
    ¬∑ <a href="privacy.html">Privacy Policy</a>
    ¬∑ <a href="https://github.com/OhmHelper/Ohm-Law-Tools" target="_blank" rel="noopener">GitHub Repo</a>
  </p>
</footer>

<button id="backToTop">‚Üë Top</button>

<script>
  /* ===== Helper functions ===== */
  function parseNum(id) {
    const v = parseFloat(document.getElementById(id).value);
    return isNaN(v) ? null : v;
  }

  function fmt(x) {
    if (!isFinite(x)) return "NaN";
    if ((Math.abs(x) >= 1e4 || Math.abs(x) <= 1e-3) && x !== 0) {
      return x.toExponential(3);
    }
    return x.toFixed(4).replace(/0+$/, "").replace(/\.$/, "");
  }

  function scrollToId(id) {
    const el = document.getElementById(id);
    if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  /* ===== THEME HANDLING ===== */
  const root = document.documentElement;
  const themeSelect = document.getElementById("themeSelect");

  function applyTheme(theme) {
    if (theme === "system") {
      const prefersLight = window.matchMedia("(prefers-color-scheme: light)").matches;
      root.setAttribute("data-theme", prefersLight ? "light" : "dark");
    } else {
      root.setAttribute("data-theme", theme);
    }
  }

  function loadTheme() {
    const saved = localStorage.getItem("labCalcTheme") || "system";
    themeSelect.value = saved;
    applyTheme(saved);
  }

  function saveTheme(theme) {
    localStorage.setItem("labCalcTheme", theme);
  }

  themeSelect.addEventListener("change", () => {
    const value = themeSelect.value;
    applyTheme(value);
    saveTheme(value);
  });

  window.matchMedia("(prefers-color-scheme: light)").addEventListener("change", e => {
    const current = localStorage.getItem("labCalcTheme") || "system";
    if (current === "system") {
      applyTheme("system");
    }
  });

  loadTheme();

  /* ===== MOBILE NAV ===== */
  const menuToggle = document.getElementById("menuToggle");
  const nav = document.getElementById("topNav");

  menuToggle.addEventListener("click", () => {
    nav.classList.toggle("nav-open");
  });

  /* ===== SEARCH ===== */
  const searchBox = document.getElementById("searchBox");
  const searchBtn = document.getElementById("searchBtn");

  function clearHighlights() {
    document.querySelectorAll(".highlight").forEach(el => el.classList.remove("highlight"));
  }

  function searchAndScroll() {
    const q = searchBox.value.trim().toLowerCase();
    if (!q) return;
    clearHighlights();

    const targets = document.querySelectorAll(".card, .section-title, .notes-section");
    let found = null;
    targets.forEach(el => {
      if (!found && el.innerText.toLowerCase().includes(q)) {
        found = el;
      }
    });

    if (found) {
      found.scrollIntoView({ behavior: "smooth", block: "start" });
      if (found.classList.contains("card") || found.classList.contains("notes-section")) {
        found.classList.add("highlight");
        setTimeout(() => found.classList.remove("highlight"), 2500);
      }
    }
  }

  searchBtn.addEventListener("click", searchAndScroll);
  searchBox.addEventListener("keydown", e => {
    if (e.key === "Enter") searchAndScroll();
  });

  /* ===== COLLAPSIBLE GROUPS ===== */
  const toggleElectronicsBtn = document.getElementById("toggleElectronics");
  const togglePhysicsBtn = document.getElementById("togglePhysics");

  function toggleGroup(groupClass, btn) {
    const cards = document.querySelectorAll("." + groupClass + "-card");
    let anyVisible = false;
    cards.forEach(c => { if (!c.classList.contains("hidden-card")) anyVisible = true; });
    const hide = anyVisible;
    cards.forEach(c => c.classList.toggle("hidden-card", hide));
    btn.textContent = hide ? "Expand" : "Collapse";
  }

  toggleElectronicsBtn.addEventListener("click", () =>
    toggleGroup("electronics", toggleElectronicsBtn)
  );
  togglePhysicsBtn.addEventListener("click", () =>
    toggleGroup("physics", togglePhysicsBtn)
  );

  /* ===== BACK TO TOP ===== */
  const backToTop = document.getElementById("backToTop");
  window.addEventListener("scroll", () => {
    if (window.scrollY > 300) backToTop.classList.add("show");
    else backToTop.classList.remove("show");
  });
  backToTop.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  /* ===== CALCULATORS (your original logic) ===== */

  // Ohm's Law
  function calcOhm() {
    let V = parseNum("ohmV");
    let I = parseNum("ohmI");
    let R = parseNum("ohmR");
    let missing = [V, I, R].filter(v => v === null).length;
    const out = document.getElementById("ohmResult");

    if (missing !== 1) {
      out.textContent = "Enter exactly two of V, I, and R.";
      return;
    }

    if (V === null) V = I * R;
    else if (I === null) I = V / R;
    else if (R === null) R = V / I;

    const P = V * I;

    out.textContent =
      `V = ${fmt(V)} V, I = ${fmt(I)} A, R = ${fmt(R)} Œ©, P = ${fmt(P)} W`;
  }

  // Equivalent resistance
  function calcReq() {
    const mode = document.getElementById("reqMode").value;
    const raw = document.getElementById("reqList").value;
    const out = document.getElementById("reqResult");

    const parts = raw.split(",").map(s => parseFloat(s.trim())).filter(v => !isNaN(v) && v > 0);

    if (parts.length === 0) {
      out.textContent = "Enter at least one positive resistance.";
      return;
    }

    let Req;
    if (mode === "series") {
      Req = parts.reduce((a, b) => a + b, 0);
    } else {
      const invSum = parts.reduce((a, b) => a + 1 / b, 0);
      Req = 1 / invSum;
    }

    out.textContent = `Equivalent resistance: ${fmt(Req)} Œ©`;
  }

  // Voltage divider
  function calcVoltageDivider() {
    const Vin = parseNum("vdVin");
    const R1 = parseNum("vdR1");
    const R2 = parseNum("vdR2");
    const out = document.getElementById("vdResult");

    if (Vin === null || R1 === null || R2 === null || R1 + R2 === 0) {
      out.textContent = "Please enter Vin, R1, and R2 (non-zero).";
      return;
    }

    const Vout = Vin * R2 / (R1 + R2);
    const I = Vin / (R1 + R2);

    out.textContent = `Vout = ${fmt(Vout)} V, Divider current ‚âà ${fmt(I)} A`;
  }

  // LED resistor
  function calcLed() {
    const Vs = parseNum("ledVs");
    const Vf = parseNum("ledVf");
    const IfmA = parseNum("ledIf");
    const out = document.getElementById("ledResult");

    if (Vs === null || Vf === null || IfmA === null) {
      out.textContent = "Enter supply voltage, LED forward voltage, and current.";
      return;
    }

    const If = IfmA / 1000;
    const Vr = Vs - Vf;
    if (Vr <= 0 || If <= 0) {
      out.textContent = "Supply voltage must be greater than Vf and current must be > 0.";
      return;
    }

    const R = Vr / If;
    const P = Vr * If;

    out.textContent =
      `Series resistor ‚âà ${fmt(R)} Œ©. Power in resistor ‚âà ${fmt(P)} W (use at least 2√ó this rating).`;
  }

  // RC
  function calcRC() {
    const R = parseNum("rcR");
    const C = parseNum("rcC");
    const out = document.getElementById("rcResult");

    if (R === null || C === null || R <= 0 || C <= 0) {
      out.textContent = "Enter positive R and C.";
      return;
    }

    const tau = R * C;
    const fc = 1 / (2 * Math.PI * R * C);

    out.textContent =
      `Time constant œÑ = ${fmt(tau)} s.  -3 dB cutoff frequency fc ‚âà ${fmt(fc)} Hz.`;
  }

  // RL
  function calcRL() {
    const R = parseNum("rlR");
    const L = parseNum("rlL");
    const out = document.getElementById("rlResult");

    if (R === null || L === null || R <= 0 || L <= 0) {
      out.textContent = "Enter positive R and L.";
      return;
    }

    const tau = L / R;
    const fc = R / (2 * Math.PI * L);

    out.textContent =
      `Time constant œÑ = ${fmt(tau)} s.  -3 dB cutoff frequency fc ‚âà ${fmt(fc)} Hz.`;
  }

  // LC resonance
  function calcLC() {
    const L = parseNum("lcL");
    const C = parseNum("lcC");
    const out = document.getElementById("lcResult");

    if (L === null || C === null || L <= 0 || C <= 0) {
      out.textContent = "Enter positive L and C.";
      return;
    }

    const f0 = 1 / (2 * Math.PI * Math.sqrt(L * C));
    const w0 = 2 * Math.PI * f0;

    out.textContent =
      `Resonant frequency f‚ÇÄ ‚âà ${fmt(f0)} Hz (œâ‚ÇÄ ‚âà ${fmt(w0)} rad/s).`;
  }

  // Energy
  function calcEnergy() {
    const C = parseNum("eC");
    const V = parseNum("eV");
    const L = parseNum("eL");
    const I = parseNum("eI");
    const out = document.getElementById("eResult");
    let parts = [];

    if (C !== null && V !== null && C > 0) {
      const Ec = 0.5 * C * V * V;
      parts.push(`Capacitor energy: ${fmt(Ec)} J`);
    }
    if (L !== null && I !== null && L > 0) {
      const El = 0.5 * L * I * I;
      parts.push(`Inductor energy: ${fmt(El)} J`);
    }

    if (parts.length === 0) {
      out.textContent = "Enter C & V and/or L & I.";
      return;
    }

    out.textContent = parts.join(" | ");
  }

  // dB gain
  function calcDB() {
    const mode = document.getElementById("dbMode").value;
    const In = parseNum("dbIn");
    const Out = parseNum("dbOut");
    const out = document.getElementById("dbResult");

    if (In === null || Out === null || In <= 0 || Out <= 0) {
      out.textContent = "Inputs must be positive.";
      return;
    }

    let dB;
    if (mode === "voltage") {
      dB = 20 * Math.log10(Out / In);
      out.textContent = `Voltage gain = ${fmt(Out / In)} (ratio), ‚âà ${fmt(dB)} dB.`;
    } else {
      dB = 10 * Math.log10(Out / In);
      out.textContent = `Power gain = ${fmt(Out / In)} (ratio), ‚âà ${fmt(dB)} dB.`;
    }
  }

  // Kinematics
  function calcKinematics() {
    const v0 = parseNum("kmV0") ?? 0;
    const a = parseNum("kmA");
    const t = parseNum("kmT");
    const dx = parseNum("kmDx");
    const out = document.getElementById("kmResult");

    if (a === null) {
      out.textContent = "Need acceleration a.";
      return;
    }

    let vFinal = null;
    let usedT = t;
    let usedDx = dx;

    if (t !== null) {
      vFinal = v0 + a * t;
      if (dx === null) {
        usedDx = v0 * t + 0.5 * a * t * t;
      }
    } else if (dx !== null) {
      vFinal = Math.sqrt(Math.max(v0 * v0 + 2 * a * dx, 0));
      usedT = (vFinal - v0) / a;
    } else {
      out.textContent = "Provide either time t or displacement Œîx.";
      return;
    }

    out.textContent =
      `Final velocity v ‚âà ${fmt(vFinal)} m/s, time t ‚âà ${fmt(usedT)} s, displacement Œîx ‚âà ${fmt(usedDx)} m.`;
  }

  // Projectile
  function calcProjectile() {
    const v0 = parseNum("pmV0");
    const angleDeg = parseNum("pmAngle");
    let g = parseNum("pmG");
    const out = document.getElementById("pmResult");

    if (v0 === null || angleDeg === null) {
      out.textContent = "Enter v‚ÇÄ and launch angle.";
      return;
    }
    if (g === null || g <= 0) g = 9.8;

    const theta = angleDeg * Math.PI / 180;
    const vx = v0 * Math.cos(theta);
    const vy = v0 * Math.sin(theta);

    const tFlight = 2 * vy / g;
    const range = vx * tFlight;
    const hMax = vy * vy / (2 * g);

    out.textContent =
      `Time of flight ‚âà ${fmt(tFlight)} s, range ‚âà ${fmt(range)} m, max height ‚âà ${fmt(hMax)} m.`;
  }

  // Newton
  function calcNewton() {
    const m = parseNum("nwM");
    const a = parseNum("nwA");
    let g = parseNum("nwG");
    const out = document.getElementById("nwResult");

    if (m === null || m <= 0) {
      out.textContent = "Enter positive mass.";
      return;
    }

    if (g === null || g <= 0) g = 9.8;

    let parts = [];
    if (a !== null) {
      const F = m * a;
      parts.push(`Net force F = ${fmt(F)} N.`);
    }
    const W = m * g;
    parts.push(`Weight W ‚âà ${fmt(W)} N.`);

    out.textContent = parts.join(" ");
  }

  // Momentum / KE
  function calcMomentumKE() {
    const m = parseNum("mkM");
    const v = parseNum("mkV");
    const out = document.getElementById("mkResult");

    if (m === null || v === null) {
      out.textContent = "Enter mass and speed.";
      return;
    }

    const p = m * v;
    const KE = 0.5 * m * v * v;

    out.textContent =
      `Momentum p = ${fmt(p)} kg¬∑m/s, kinetic energy KE = ${fmt(KE)} J.`;
  }
</script>
</body>
</html>
